{% extends 'base.html' %}
{% block content %}
{% include 'components/navigation-bar.html' %}

{% if user_role == 1 %}
    <h1 class="text-4xl font-bold text-center mb-6 text-black">Promo Spesial untuk Kamu!</h1>
    <h2 class="text-xl text-center mb-4 text-gray-700">Kejar Diskon Sekarang!</h2>
    <div class="text-center mb-4">
        <a href="{% url 'promo:rewards_promo' %}">
            <button class="bg-gray-800 text-white px-6 py-3 rounded hover:bg-gray-700 transition">Rewards</button>
        </a>
    </div>

    {% if messages %}
        <div id="flash-message" class="bg-green-100 border border-green-400 text-green-700 px-3 py-2 rounded relative mt-4 text-sm">
            {% for message in messages %}
                <p class="mb-1">{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}

    <div class="container mx-auto my-8">
        <div class="mb-4">
            <label for="filter" class="text-lg">Filter:</label>
            <form method="GET" action="{% url 'promo:show_promo' %}" class="inline">
                <select name="filter" id="filter" class="ml-2 p-2 border rounded" onchange="this.form.submit()">
                    <option value="">Pilih Filter</option>
                    <option value="highest_discount" {% if filter == 'highest_discount' %}selected{% endif %}>Diskon Terbanyak</option>
                    <option value="nearest_time" {% if filter == 'nearest_time' %}selected{% endif %}>Waktu Terdekat</option>
                </select>
            </form>
        </div>
    </div>
    

{% elif user_role == 2 %}
    <h1 class="text-4xl font-bold text-center mb-6 text-black">Update Promo Outlet Kamu!</h1>
    <h2 class="text-xl text-center mb-4 text-gray-700">Buat Promo Spesial Hari Ini!</h2>
    <div class="text-center mb-4">
        <a href="{% url 'promo:history_promo' %}">
         <button class="bg-gray-800 text-white px-6 py-3 rounded hover:bg-gray-700 transition">History</button>
        </a>
    </div>

{% endif %}



<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% if promos %}
        {% for promo in promos %}
            <div class="bg-white border border-gray-300 rounded-lg shadow-md p-4 transition-transform transform hover:scale-105">
                <h2 class="text-2xl font-semibold text-black">{{ promo.title }}</h2>
                <p class="text-gray-700">{{ promo.description }}</p>
                <p class="font-bold text-black">Diskon: {{ promo.discount_percentage }}%</p>
                <p class="font-bold text-black">Kode Promo: <span class="text-red-500">{{ promo.promo_code }}</span></p>
                <p class="font-bold text-black">Valid Hingga: {{ promo.end_date }}</p>

                {% if user_role == 1 %}
                    <form action="{% url 'promo:redeem_promo' promo.id %}" method="post">
                        {% csrf_token %}
                        <button class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">Redeem</button>
                    </form>
                {% elif user_role == 2 %}
                    <div class="flex justify-between mt-4">
                        <a href="{% url 'promo:update_promo' promo.id %}">
                            <button class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-700 transition">Edit Promo</button>
                        </a>
                        <a href="{% url 'promo:delete_promo' promo.id %}">
                            <button class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-700 transition">Delete Promo</button>
                        </a>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <p class="text-center text-black">Tidak ada promosi aktif saat ini.</p>
    {% endif %}
</div>

{% if user_role == 2 %}
    <div class="text-center mt-6">
        <a href="{% url 'promo:create_promo' %}">
            <button class="bg-gray-800 text-white px-6 py-3 rounded hover:bg-gray-700 transition">Buat Promo Baru</button>
        </a>
    </div>
{% endif %}

<script>
    function filterPromos() {
        const filterValue = document.getElementById('filter').value;
        const url = new URL(window.location.href);
        url.searchParams.set('filter', filterValue);
        window.location.href = url.toString();
    }

    setTimeout(function() {
        var flashMessage = document.getElementById('flash-message');
        if (flashMessage) {
            flashMessage.style.display = 'none';
        }
    }, 2000); // 5000 milidetik = 5 detik
</script>

{% endblock content %}



